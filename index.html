<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Workout Tracker</title>
  <style>
    :root {
      --bg: #0e1116;
      --panel: #151926;
      --card: #1b2132;
      --text: #e6e9ee;
      --muted: #aab3c2;
      --ring: rgba(255,255,255,.08);
      --accent: #7dd3fc;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: linear-gradient(180deg, #0c1018 0%, #0e1116 100%);
      color: var(--text);
      font: 500 16px/1.45 system-ui, -apple-system, sans-serif;
      min-height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      position: sticky;
      top: 0;
      background: rgba(14,17,22,.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--ring);
      z-index: 100;
      padding: 16px 20px;
      margin: 0 -20px 20px;
    }
    h1 {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--ring);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--accent);
    }
    select, input, button {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid var(--ring);
      background: var(--panel);
      color: var(--text);
      font: inherit;
      font-size: 15px;
    }
    select, input {
      margin-bottom: 12px;
    }
    button {
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    button:hover {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
    }
    .timer-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 16px 0;
    }
    .timer-buttons button {
      margin: 0;
    }
    .timer-display {
      font-size: 48px;
      font-weight: 700;
      text-align: center;
      padding: 30px;
      background: var(--panel);
      border-radius: 12px;
      margin: 16px 0;
    }
    .timer-controls {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th {
      text-align: left;
      padding: 12px 8px;
      border-bottom: 2px solid var(--ring);
      font-weight: 600;
      font-size: 14px;
      color: var(--muted);
    }
    td {
      padding: 12px 8px;
      border-bottom: 1px solid var(--ring);
    }
    .exercise-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .prescribed {
      color: var(--muted);
      font-size: 14px;
    }
    .log-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    .log-inputs input {
      margin: 0;
      padding: 14px 12px;
      font-size: 16px;
    }
    .add-set-btn {
      margin: 0;
      padding: 14px 20px;
      font-size: 16px;
      width: 100%;
    }
    .logged-sets {
      margin-top: 12px;
      font-size: 14px;
    }
    .logged-set {
      display: inline-block;
      background: var(--panel);
      padding: 6px 12px;
      border-radius: 8px;
      margin: 4px 4px 4px 0;
      border: 1px solid var(--ring);
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    @media (max-width: 768px) {
      .log-inputs {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <meta name="theme-color" content="#0e1116">
  <link rel="manifest" href="./manifest.webmanifest">
</head>
<body>
  <header>
    <h1>ðŸ’ª Workout Tracker</h1>
  </header>

  <div class="container">
    <div class="card">
      <label for="workout-select" class="section-title">Select Workout</label>
      <select id="workout-select">
        <option value="">-- Choose a workout --</option>
      </select>
    </div>

    <div class="card" id="workout-card" style="display: none;">
      <div class="section-title" id="workout-title"></div>
      <table>
        <thead>
          <tr>
            <th>Exercise</th>
            <th>Log Sets</th>
          </tr>
        </thead>
        <tbody id="workout-body"></tbody>
      </table>
    </div>

    <div class="card empty-state" id="empty-state">
      <p>ðŸ‘† Select a workout above to get started</p>
    </div>

    <div class="card" id="timer-card" style="display: none;">
      <div class="section-title">Rest Timer</div>
      <div class="timer-buttons">
        <button onclick="setTimer(30)">30s</button>
        <button onclick="setTimer(60)">60s</button>
        <button onclick="setTimer(90)">90s</button>
      </div>
      <div class="timer-display" id="timer-display">0:00</div>
      <div class="timer-controls">
        <button onclick="startTimer()">Start</button>
        <button onclick="pauseTimer()">Pause</button>
        <button onclick="resetTimer()">Reset</button>
      </div>
    </div>

    <div class="card">
      <button onclick="saveWorkout()" style="margin-bottom: 10px;">ðŸ’¾ Save Progress</button>
      <button onclick="loadWorkout()" style="margin-bottom: 10px;">ðŸ“‚ Load Progress</button>
      <button onclick="exportWorkout()">ðŸ“¤ Export as Text</button>
    </div>
  </div>

  <script>
    const WORKOUTS = {
      'bbb-ohp': {
        name: '5/3/1 BBB - Overhead Press',
        exercises: [
          { name: 'Overhead Press', prescribed: '65% TM Ã— 5' },
          { name: 'Overhead Press', prescribed: '75% TM Ã— 5' },
          { name: 'Overhead Press', prescribed: '85% TM Ã— 5+ (AMRAP)' },
          { name: 'Overhead Press BBB', prescribed: '50% TM Ã— 10 (5 sets)' },
          { name: 'Dips', prescribed: '3 Ã— 10' },
          { name: 'Lateral Raises', prescribed: '3 Ã— 12' }
        ]
      },
      'bbb-dead': {
        name: '5/3/1 BBB - Deadlift',
        exercises: [
          { name: 'Deadlift', prescribed: '65% TM Ã— 5' },
          { name: 'Deadlift', prescribed: '75% TM Ã— 5' },
          { name: 'Deadlift', prescribed: '85% TM Ã— 5+ (AMRAP)' },
          { name: 'Deadlift BBB', prescribed: '50% TM Ã— 10 (5 sets)' },
          { name: 'Back Extensions', prescribed: '3 Ã— 10' },
          { name: 'Hanging Leg Raises', prescribed: '3 Ã— 12' }
        ]
      },
      'bbb-bench': {
        name: '5/3/1 BBB - Bench Press',
        exercises: [
          { name: 'Bench Press', prescribed: '65% TM Ã— 5' },
          { name: 'Bench Press', prescribed: '75% TM Ã— 5' },
          { name: 'Bench Press', prescribed: '85% TM Ã— 5+ (AMRAP)' },
          { name: 'Bench Press BBB', prescribed: '50% TM Ã— 10 (5 sets)' },
          { name: 'DB Incline Press', prescribed: '3 Ã— 10' },
          { name: 'Triceps Pushdowns', prescribed: '3 Ã— 12' }
        ]
      },
      'bbb-squat': {
        name: '5/3/1 BBB - Squat',
        exercises: [
          { name: 'Squat', prescribed: '65% TM Ã— 5' },
          { name: 'Squat', prescribed: '75% TM Ã— 5' },
          { name: 'Squat', prescribed: '85% TM Ã— 5+ (AMRAP)' },
          { name: 'Squat BBB', prescribed: '50% TM Ã— 10 (5 sets)' },
          { name: 'Leg Press', prescribed: '3 Ã— 10' },
          { name: 'Walking Lunges', prescribed: '3 Ã— 12/leg' }
        ]
      }
    };

    let currentWorkout = null;
    let workoutLog = {};
    let timerSeconds = 0;
    let timerInterval = null;

    function loadState() {
      try {
        const saved = localStorage.getItem('workout_log');
        if (saved) workoutLog = JSON.parse(saved);
      } catch (e) {}
    }

    function saveState() {
      try {
        localStorage.setItem('workout_log', JSON.stringify(workoutLog));
      } catch (e) {}
    }

    function initWorkoutSelect() {
      const select = document.getElementById('workout-select');
      Object.entries(WORKOUTS).forEach(([id, workout]) => {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = workout.name;
        select.appendChild(option);
      });
      select.addEventListener('change', (e) => {
        if (e.target.value) displayWorkout(e.target.value);
        else hideWorkout();
      });
    }

    function displayWorkout(workoutId) {
      currentWorkout = workoutId;
      const workout = WORKOUTS[workoutId];
      
      document.getElementById('workout-title').textContent = workout.name;
      document.getElementById('empty-state').style.display = 'none';
      document.getElementById('workout-card').style.display = 'block';
      document.getElementById('timer-card').style.display = 'block';

      const tbody = document.getElementById('workout-body');
      tbody.innerHTML = '';

      workout.exercises.forEach((exercise, idx) => {
        const tr = document.createElement('tr');
        
        const tdName = document.createElement('td');
        tdName.innerHTML = `
          <div class="exercise-name">${exercise.name}</div>
          <div class="prescribed">${exercise.prescribed}</div>
        `;
        
        const tdLog = document.createElement('td');
        tdLog.innerHTML = `
          <div class="log-inputs">
            <input type="number" id="sets-${idx}" placeholder="Sets" min="1" value="1">
            <input type="number" id="reps-${idx}" placeholder="Reps" min="0">
            <input type="number" id="weight-${idx}" placeholder="Weight" min="0" step="2.5">
          </div>
          <button class="add-set-btn" onclick="logSet('${workoutId}', ${idx}, '${exercise.name}')">Add Set</button>
          <div class="logged-sets" id="logged-${idx}"></div>
        `;
        
        tr.appendChild(tdName);
        tr.appendChild(tdLog);
        tbody.appendChild(tr);
        
        updateLoggedSets(workoutId, idx, exercise.name);
      });
    }

    function hideWorkout() {
      currentWorkout = null;
      document.getElementById('empty-state').style.display = 'block';
      document.getElementById('workout-card').style.display = 'none';
      document.getElementById('timer-card').style.display = 'none';
    }

    function logSet(workoutId, idx, exerciseName) {
      const sets = parseInt(document.getElementById(`sets-${idx}`).value) || 1;
      const reps = document.getElementById(`reps-${idx}`).value;
      const weight = document.getElementById(`weight-${idx}`).value;
      
      if (!reps || !weight) {
        alert('Enter reps and weight');
        return;
      }

      if (!workoutLog[workoutId]) workoutLog[workoutId] = {};
      if (!workoutLog[workoutId][exerciseName]) workoutLog[workoutId][exerciseName] = [];

      for (let i = 0; i < sets; i++) {
        workoutLog[workoutId][exerciseName].push({
          reps: parseInt(reps),
          weight: parseFloat(weight),
          timestamp: new Date().toISOString()
        });
      }

      document.getElementById(`sets-${idx}`).value = '1';
      document.getElementById(`reps-${idx}`).value = '';
      document.getElementById(`weight-${idx}`).value = '';

      updateLoggedSets(workoutId, idx, exerciseName);
      saveState();
    }

    function updateLoggedSets(workoutId, idx, exerciseName) {
      const loggedDiv = document.getElementById(`logged-${idx}`);
      if (!loggedDiv) return;

      const sets = workoutLog[workoutId]?.[exerciseName] || [];
      
      if (sets.length === 0) {
        loggedDiv.innerHTML = '';
        return;
      }

      loggedDiv.innerHTML = '<div style="color: var(--muted); font-size: 13px; margin-bottom: 6px;">Logged:</div>' + 
        sets.map(set => `<span class="logged-set">${set.weight}lb Ã— ${set.reps}</span>`).join('');
    }

    function setTimer(seconds) {
      timerSeconds = seconds;
      updateTimerDisplay();
      startTimer();
    }

    function startTimer() {
      if (timerInterval) return;
      if (timerSeconds === 0) return;

      timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();

        if (timerSeconds === 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          if ('vibrate' in navigator) navigator.vibrate([200, 100, 200]);
          alert('Rest complete! ðŸ’ª');
        }
      }, 1000);
    }

    function pauseTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function resetTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      timerSeconds = 0;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const display = document.getElementById('timer-display');
      const mins = Math.floor(timerSeconds / 60);
      const secs = timerSeconds % 60;
      display.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function saveWorkout() {
      const json = JSON.stringify(workoutLog, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `workout-log-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadWorkout() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            workoutLog = JSON.parse(e.target.result);
            saveState();
            if (currentWorkout) displayWorkout(currentWorkout);
          } catch (err) {
            alert('Failed to load');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function exportWorkout() {
      if (!currentWorkout) {
        alert('Select a workout first');
        return;
      }

      const workout = WORKOUTS[currentWorkout];
      let text = `${workout.name}\n\n`;

      workout.exercises.forEach(exercise => {
        text += `${exercise.name} - ${exercise.prescribed}\n`;
        const sets = workoutLog[currentWorkout]?.[exercise.name] || [];
        if (sets.length > 0) {
          text += 'Logged: ' + sets.map(s => `${s.weight}lb Ã— ${s.reps}`).join(', ') + '\n';
        }
        text += '\n';
      });

      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `workout.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadState();
      initWorkoutSelect();
      updateTimerDisplay();
    });
  </script>
</body>
</html>
